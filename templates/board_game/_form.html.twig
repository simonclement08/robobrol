{{ form_start(form) }}
    {{ form_row(form.name) }}
    {{ form_row(form.description) }}
    {{ form_row(form.nbMinPlayer) }}
    {{ form_row(form.nbMaxPlayer) }}
    {{ form_row(form.gameTime) }}
    {{ form_row(form.ageMin) }}
    {{ form_row(form.target) }}
    {{ form_row(form.price) }}
    {{ form_row(form.gamme) }}
    <h3>Images</h3>
    <div class="images"
        data-index="{{ form.images|length > 0 ? form.images|last.vars.name + 1 : 0 }}"
        data-prototype="{{ form_widget(form.images.vars.prototype)|e }}"
    >
    {% for image in form.images %}
            <div class="form_image">{{ form_row(image) }}</div>
    {% endfor %}
    </div>
    <div class="form-group">
        <button type="button" class="btn btn-success add_item_link" data-collection-holder-class="images">Ajouter une image</button>
    </div>
    <button class="btn btn-primary">{{ button_label|default('Enregistrer') }}</button>
{{ form_end(form) }}

{% block javascripts %}
<script>
const addTagFormDeleteLink = (item) => {
    const removeFormButton = document.createElement('button');
    removeFormButton.innerText = 'Supprimer';
    removeFormButton.classList.add("btn");
    removeFormButton.classList.add("btn-warning");

    item.append(removeFormButton);

    removeFormButton.addEventListener('click', (e) => {
        e.preventDefault();
        // remove the li for the tag form
        item.remove();
    });
}

const addFormToCollection = (e) => {
    const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

    const item = document.createElement('div');

    item.innerHTML = collectionHolder
    .dataset
    .prototype
    .replace(
        /__name__/g,
        collectionHolder.dataset.index
    );

    collectionHolder.appendChild(item);
    addTagFormDeleteLink(item);
    collectionHolder.dataset.index++;
};

document
    .querySelectorAll('.add_item_link')
    .forEach(btn => {
        btn.addEventListener("click", addFormToCollection)
    });

document
    .querySelectorAll('div.images .form_image')
    .forEach((image) => {
        addTagFormDeleteLink(image)
    })
</script>
{% endblock %}
